= Network Protocol Specification
include::../../utils/attribute-include[]

This document provides a technical overview of common networking protocols, including:

* Header structures
* Field definitions
* Architectural placement

== Layer 2: Data Link Protocols

=== Ethernet II (MAC)

**Standard:** IEEE 802.3 / DIW (No specific RFC, though see RFC 894 for IP over Ethernet)
**Layer:** 2
**Header Size:** 14 bytes (excluding Preamble/FCS)

Ethernet II is the most prevalent frame format used in modern TCP/IP networks.

[source,text]
----
 0                   1                   2       
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Destination MAC Address (48)         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|             Source MAC Address (48)           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       EtherType (16)          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
----

.Ethernet II Header Fields
[cols="1,1,3"]
|===
|Field |Size |Description

|Destination MAC |48 bits |Physical address of the receiver
|Source MAC |48 bits |Physical address of the sender
|EtherType |16 bits |Encapsulated protocol identifier (e.g., 0x0800 for IPv4, 0x86DD for IPv6)
|===

== Layer 2.5: Tagging and Labeling

=== IEEE 802.1Q (VLAN)

**Standard:** IEEE 802.1Q (RFC 2674 defines MIBs)
**Layer:** 2 (Tagging)
**Header Size:** 4 bytes

VLAN tags identify membership in a virtual broadcast domain.

[source,text]
----
 0                   1       
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       TPID (0x8100)           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| PCP |D|        VID (12)       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
----

.VLAN Tag Fields
[cols="1,1,3"]
|===
|Field |Size |Description

|TPID |16 bits |Tag Protocol Identifier (0x8100)
|PCP |3 bits |Priority Code Point (QoS / CoS)
|DEI |1 bit |Drop Eligible Indicator
|VID |12 bits |VLAN Identifier (0–4095)
|===

=== MPLS (Multi-Protocol Label Switching)

**Standard:** RFC 3031 / RFC 3032
**Layer:** 2.5
**Header Size:** 4 bytes per label

MPLS forwards packets using short labels instead of IP lookups.

[source,text]
----
 0                   1                   2       
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                Label (20)             | TC  |S|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    TTL (8)    |
+-+-+-+-+-+-+-+-+
----

.MPLS Label Stack Entry
[cols="1,1,3"]
|===
|Field |Size |Description

|Label |20 bits |Switching label
|TC |3 bits |Traffic Class (QoS / ECN)
|S |1 bit |Bottom of Stack flag
|TTL |8 bits |Time to Live
|===

=== CSIG (Congestion Signal)

**Standard:** No Public RFC (Specification maintained by the CSIG Steering Committee / Industry Consortia)
**Layer:** 2 / 2.5 (implementation dependent)
**Header Size:** Typically 4–8 bytes

Used in specialized high-bandwidth environments to communicate congestion metrics.

.CSIG 4B (4-Byte Variant)
[source,text]
----
 0                   1                   2       
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Type| Res |            Metric (24)            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
----

.CSIG 4B (4-Byte Variant)
[cols="1,1,3"]
|===
|Field |Size |Description

|Type |4 bits |Signal identifier
|Reserved |4 bits |Reserved for future use
|Metric |24 bits |Congestion metric (e.g., queue depth)
|===

.CSIG 8B (8-Byte Variant)
[source,text]
----
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Type (8)   |   Flags (8)   |          Metric (16)          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Timestamp (32)                         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
----

.CSIG 8B (8-Byte Variant)
[cols="1,1,3"]
|===
|Field |Size |Description

|Type |8 bits |Signal identifier
|Flags |8 bits |Control bits
|Timestamp |32 bits |Ingress/Egress timestamp
|Metric |16 bits |Extended congestion metric
|===

== Layer 3: Network Protocols

=== IPv4

**Standard:** RFC 791
**Layer:** 3
**Header Size:** 20 bytes (minimum)

Primary internet networking protocol.

[source,text]
----
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Version|  IHL  |Type of Service|          Total Length         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Identification        |Flags|      Fragment Offset    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Time to Live |    Protocol   |         Header Checksum       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Source IP Address                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Destination IP Address                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
----

.IPv4 Header Fields
[cols="1,1,3"]
|===
|Field |Size |Description

|Version |4 bits |Always 4
|IHL |4 bits |Header length
|ToS / DSCP |8 bits |Service class
|Total Length |16 bits |Packet size
|Identification |16 bits |Fragment identification
|Flags |3 bits |Fragment control
|Fragment Offset |13 bits |Fragment position
|TTL |8 bits |Time to Live
|Protocol |8 bits |Encapsulated L4 protocol (TCP=6, UDP=17)
|Header Checksum |16 bits |Header integrity
|Source Address |32 bits |Sender IP
|Destination Address |32 bits |Receiver IP
|===

=== IPv6

**Standard:** RFC 8200
**Layer:** 3
**Header Size:** 40 bytes (fixed)

Designed to solve IPv4 address exhaustion.

[source,text]
----
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Version| Traffic Class |           Flow Label                  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Payload Length        |  Next Header  |   Hop Limit   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                                               +
|                                                               |
+                         Source Address                        +
|                           (128 bits)                          |
+                                                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                                               +
|                                                               |
+                      Destination Address                      +
|                           (128 bits)                          |
+                                                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
----

.IPv6 Header Fields
[cols="1,1,3"]
|===
|Field |Size |Description

|Version |4 bits |Always 6
|Traffic Class |8 bits |QoS marking
|Flow Label |20 bits |Flow identification
|Payload Length |16 bits |Payload size
|Next Header |8 bits |Next protocol
|Hop Limit |8 bits |TTL equivalent
|Source Address |128 bits |Sender IP
|Destination Address |128 bits |Receiver IP
|===

=== IPsec (Encapsulating Security Payload - ESP)

**Standard:** RFC 4303
**Layer:** 3
**Header Size:** Variable (Minimum ~32 bytes)

[source,text]
----
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Security Parameters Index (SPI)                 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Sequence Number                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Payload Data (Variable)                    |
~                                                               ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Padding (0-255 bytes)     |  Pad Length   | Next Header   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                 Integrity Check Value (Variable)              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
----

.IPsec ESP Fields
[cols="1,1,3"]
|===
|Field |Size |Description

|SPI |32 bits |Security Parameters Index
|Sequence |32 bits |Anti-replay counter
|IV |64-128 bits|Initialization Vector
|ICV |Variable |Integrity Check Value (Trailer)
|===

=== PSP (PSP Security Protocol)

**Standard:** No Public RFC (Specification by Google/PSP Working Group)
**Layer:** 3.5 (Transport-independent)
**Header Size:** 16 bytes

Hardware-offload friendly encryption used in large-scale cloud environments.

[source,text]
----
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Next Header   | Header Len    |S|D|R|       Reserved          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Security Parameters Index (SPI)                 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Initialization Vector                    |
|                            (64 bits)                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
----

.PSP Header Fields
[cols="1,1,3"]
|===
|Field |Size |Description

|Next Header |8 bits |Identifier for the next protocol
|Header Len |8 bits |Total PSP header length
|S / D |2 bits |Sampled / Direction bits
|SPI |32 bits |Security Parameters Index
|IV |64 bits |Initialization Vector
|===

=== IFA (In-band Flow Analyzer)

**Standard:** Draft-ietf-ippm-ioam-data (Related to IOAM standards like RFC 9197)
**Layer:** 3 (Telemetry Extension)

IFA embeds metadata into packets to provide per-hop visibility.

[source,text]
----
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Ver |L|  Res  |   Hop Limit   |         Device ID (High)      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Device ID (Low)       |        Residence Time (High)  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
----

.IFA Metadata Fields
[cols="1,1,3"]
|===
|Field |Size |Description

|Version |4 bits |IFA version
|Hop Limit |8 bits |Max hops to record
|Device ID |32 bits |Unique identifier of the switch
|Residence Time|32 bits |Time packet spent in the device
|===

== Layer 4: Transport Protocols

=== UDP (User Datagram Protocol)

**Standard:** RFC 768
**Layer:** 4
**Header Size:** 8 bytes

Lightweight, connectionless transport protocol.

[source,text]
----
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Source Port          |       Destination Port        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|            Length             |           Checksum            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
----

.UDP Header Fields
[cols="1,1,3"]
|===
|Field |Size |Description

|Source Port |16 bits |Sender port
|Destination Port |16 bits |Receiver port
|Length |16 bits |Header + data size
|Checksum |16 bits |Integrity check
|===

=== TCP (Transmission Control Protocol)

**Standard:** RFC 9293 (replaces RFC 793)
**Layer:** 4
**Header Size:** 20 bytes (minimum)

Connection-oriented protocol for reliable delivery.

[source,text]
----
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Source Port          |       Destination Port        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Sequence Number                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Acknowledgment Number                      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Data |           |U|A|P|R|S|F|                               |
| Offset| Reserved  |R|C|S|S|Y|I|            Window             |
|       |           |G|K|H|T|N|N|                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           Checksum            |         Urgent Pointer        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Options (if any)                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
----

.TCP Header Fields
[cols="1,1,3"]
|===
|Field |Size |Description

|Source Port |16 bits |Sender port
|Destination Port |16 bits |Receiver port
|Sequence Number |32 bits |Data position in stream
|Acknowledgment Number |32 bits |Next expected byte
|Data Offset |4 bits |Header length
|Flags |9 bits |SYN, ACK, FIN, RST, PSH, URG
|Window |16 bits |Flow control
|Checksum |16 bits |Integrity
|Urgent Pointer |16 bits |Urgent data marker
|===

=== SCTP (Stream Control Transmission Protocol)

**Standard:** RFC 9260 (replaces RFC 4960)
**Layer:** 4
**Header Size:** 12 bytes (Common Header)

Supports multi-homing and multi-streaming.

[source,text]
----
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Source Port Number        |     Destination Port Number   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Verification Tag                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                            Checksum                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
----

.SCTP Common Header
[cols="1,1,3"]
|===
|Field |Size |Description

|Source Port |16 bits |Sender port
|Dest Port |16 bits |Receiver port
|Verification Tag|32 bits |Packet validation
|Checksum |32 bits |CRC32c
|===

=== DTLS (Datagram Transport Layer Security)

**Standard:** RFC 6347 (DTLS 1.2) / RFC 9147 (DTLS 1.3)
**Layer:** 4 (Security for UDP)
**Header Size:** 13 bytes (Record Header)

[source,text]
----
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Content Type |       Version         |          Epoch        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                         Sequence Number                       |
|                            (48 bits)                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|             Length            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
----

.DTLS Record Header
[cols="1,1,3"]
|===
|Field |Size |Description

|Content Type |8 bits |Handshake, Alert, or Data
|Version |16 bits |DTLS version identifier
|Epoch |16 bits |Cipher state
|Sequence Num |48 bits |Counter for replay protection
|Length |16 bits |Payload length
|===
